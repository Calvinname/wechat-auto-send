# 微信自动发送工具

根据CSDN博客文章开发的微信自动发送消息和文件的工具，支持自动识别微信路径、精准定位界面元素、发送状态校验和详细日志记录。

## 功能特性

- ✅ **智能微信路径识别**：自动从注册表和默认路径查找微信，支持手动选择
- ✅ **联系人列表管理**：支持手动输入或从.txt文件读取联系人列表
- ✅ **编码自动检测**：自动尝试不同编码读取联系人文件
- ✅ **灵活消息输入**：自由输入消息内容，输入"end"结束
- ✅ **多消息发送**：支持发送多条文本消息
- ✅ **多文件发送**：支持发送多个文件
- ✅ **定时发送**：支持设置定时发送时间
- ✅ **发送状态校验**：检查发送是否成功
- ✅ **详细日志记录**：记录所有操作步骤和结果
- ✅ **发送完成后自动上锁**：保护微信隐私

## 环境要求

- Windows 系统
- Python 3.7+
- 微信已登录并运行

## 安装依赖

```bash
pip install -r requirements.txt
```

## 使用方法

### 1. 直接运行Python脚本

```bash
python wechat_auto_send.py
```

## 操作步骤

1. 运行程序
2. 选择联系人列表输入方式：
   - 选择1：手动输入联系人（每行一个，按Enter键结束）
   - 选择2：从.txt文件读取联系人（自动检测编码）
3. 输入消息内容：
   - 自由输入消息，每行一条
   - 输入"end"结束消息输入
   - 输入"back"重新输入所有消息
4. 输入文件个数和文件路径（可选）
5. 输入定时发送时间（格式：HH:MM，留空则立即发送）
6. 等待程序自动执行发送操作
7. 查看发送结果和日志

## 注意事项

1. **执行环境**：
   - 执行过程中电脑不能息屏
   - 执行过程中不要操作鼠标和键盘
   - 微信必须已登录

2. **微信路径**：
   - 程序会自动从注册表和默认路径查找微信
   - 如果未找到，会提示手动输入路径

3. **文件发送**：
   - 发送的文件必须存在
   - 支持发送任意类型的文件

4. **日志文件**：
   - 日志文件位于 `wechat_auto_send.log`
   - 包含详细的操作步骤和发送结果

5. **依赖安装**：
   - 如果遇到依赖安装问题，请使用管理员权限运行命令提示符

## 故障排除

| 问题 | 可能原因 | 解决方案 |
|------|----------|----------|
| 微信无法打开 | 微信未安装或路径错误 | 手动输入正确的微信路径 |
| 无法找到联系人 | 联系人名称错误 | 确认联系人名称是否正确 |
| 文件发送失败 | 文件不存在或路径错误 | 确认文件路径是否正确 |
| 发送状态未知 | 网络问题或微信异常 | 检查网络连接和微信状态 |
| 日志文件未生成 | 权限问题 | 以管理员权限运行程序 |

## 项目结构

```
wechat_auto_send/
├── wechat_auto_send.py   # 主脚本
├── requirements.txt      # 依赖文件
├── build_exe.bat         # 打包脚本
├── README.md             # 说明文档
└── wechat_auto_send.log  # 日志文件（自动生成）
```

## 技术实现

- **路径识别**：使用 `winreg` 从注册表获取微信安装路径
- **界面操作**：使用 `pyautogui` 进行鼠标和键盘操作
- **剪贴板**：使用 `pyperclip` 进行内容复制粘贴
- **键盘模拟**：使用 `win32api` 模拟键盘事件
- **时间处理**：使用 `datetime` 处理定时发送
- **日志记录**：使用文件操作记录详细日志

## 日志格式

日志文件 `wechat_auto_send.log` 包含以下信息：

```
[2026-02-18 10:00:00] [INFO] === 微信自动发送工具启动 ===
[2026-02-18 10:00:01] [INFO] 从注册表获取微信路径: C:\Program Files\Tencent\Weixin\Weixin.exe
[2026-02-18 10:00:02] [INFO] 打开微信: C:\Program Files\Tencent\Weixin\Weixin.exe
[2026-02-18 10:00:07] [INFO] 开始搜索联系人: 张三
[2026-02-18 10:00:10] [INFO] 联系人搜索完成: 张三
[2026-02-18 10:00:11] [INFO] 开始定位微信界面元素
[2026-02-18 10:00:12] [INFO] 找到微信窗口: 微信
[2026-02-18 10:00:13] [INFO] 开始发送1条消息
[2026-02-18 10:00:13] [INFO] 发送第1条消息
[2026-02-18 10:00:13] [INFO] 开始发送消息: 你好，这是测试消息...
[2026-02-18 10:00:16] [INFO] 开始检查发送状态
[2026-02-18 10:00:18] [INFO] 发送操作已执行，假设发送成功
[2026-02-18 10:00:18] [INFO] 消息发送成功: 你好，这是测试消息...
[2026-02-18 10:00:19] [INFO] 执行微信上锁操作
[2026-02-18 10:00:19] [INFO] 微信已自动上锁
[2026-02-18 10:00:20] [INFO] === 发送任务完成 ===
[2026-02-18 10:00:20] [INFO] 总发送数: 1
[2026-02-18 10:00:20] [INFO] 成功数: 1
[2026-02-18 10:00:20] [INFO] 失败数: 0
[2026-02-18 10:00:25] [INFO] 程序退出
```

## 免责声明

此工具仅用于学习和个人使用，请勿用于商业用途或其他不当用途。使用此工具产生的任何后果由使用者自行承担。
